<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Halloween Haunted Hunt</title>
  <style>
    body { margin:0; overflow:hidden; background:black; }
    canvas { display:block; background:#222; }

    /* Store menus */
    .store {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #333;
      border: 4px solid orange;
      padding: 20px;
      width: 300px;
      display: none;
      color: white;
      font-family: sans-serif;
      z-index: 10;
    }
    .store h2 { margin-top:0; }
    .store button { margin:5px; }
    .close-btn {
      position: absolute;
      top: 5px; right: 5px;
      background: red; color: white; border:none; cursor:pointer;
      font-size: 16px; padding: 2px 6px;
    }

    /* HUD buttons */
    #hud {
      position: absolute;
      bottom: 10px;
      width: 100%;
      text-align: center;
      z-index: 5;
    }
    #hud button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #locatorBtn { background: purple; color:white; }
    #teleportBtn { background: green; color:white; }
    #spawnBtn { background: blue; color:white; }
  </style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>

<!-- Item Store -->
<div id="itemStore" class="store">
  <button class="close-btn" onclick="closeStore('itemStore')">X</button>
  <h2>Item Store</h2>
  <div>
    <img src="https://i.ibb.co/bgmg3RpW/IMG-0240.png" width="32"> Item Locator - 5 üç¨
    <button onclick="buyItem('locator')">Buy</button>
  </div>
  <div>
    <img src="https://freesvg.org/img/teleport.png" width="32"> Teleporter - 20 üç¨
    <button onclick="buyItem('teleport')">Buy</button>
  </div>
</div>

<!-- Upgrade Store -->
<div id="upgradeStore" class="store">
  <button class="close-btn" onclick="closeStore('upgradeStore')">X</button>
  <h2>Upgrade Store</h2>
  <p>Locator Upgrade - 8 üç¨</p>
  <button onclick="buyUpgrade('locator')">Buy</button>
  <p>Teleporter Upgrade - 8 üç¨</p>
  <button onclick="buyUpgrade('teleport')">Buy</button>
</div>

<!-- HUD -->
<div id="hud">
  <button id="locatorBtn" onclick="useLocator()">Locator</button>
  <button id="teleportBtn" onclick="useTeleporter()">Teleporter</button>
  <button id="spawnBtn" onclick="spawnCenter()">Spawn</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// World
const mapSize = 2000;
let player = {x: mapSize/2, y: mapSize/2, size:40, speed:4};
let candyCorn = 0;

// Current item to find
let targetItem = {x:500, y:500, size:40};

// Camera
let camX=0, camY=0;

// Store triggers
const itemStorePos = {x: mapSize/2 - 100, y: mapSize/2};
const upgradeStorePos = {x: mapSize/2 + 100, y: mapSize/2};

// Inventory
let hasLocator=false, hasTeleporter=false;
let locatorUpgrade=0, teleportUpgrade=0;
let locatorCooldown=0, teleportCooldown=0;

// Keyboard
let keys={};
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

function update(){
  // Move
  if(keys["ArrowUp"]) player.y-=player.speed;
  if(keys["ArrowDown"]) player.y+=player.speed;
  if(keys["ArrowLeft"]) player.x-=player.speed;
  if(keys["ArrowRight"]) player.x+=player.speed;

  // Camera follows
  camX = player.x - canvas.width/2;
  camY = player.y - canvas.height/2;

  // Collision with item
  if(Math.abs(player.x-targetItem.x)<40 && Math.abs(player.y-targetItem.y)<40){
    candyCorn+=5;
    spawnNewItem();
  }

  // Touch stores
  if(Math.abs(player.x-itemStorePos.x)<50 && Math.abs(player.y-itemStorePos.y)<50){
    document.getElementById("itemStore").style.display="block";
  }
  if(Math.abs(player.x-upgradeStorePos.x)<50 && Math.abs(player.y-upgradeStorePos.y)<50){
    document.getElementById("upgradeStore").style.display="block";
  }

  if(locatorCooldown>0) locatorCooldown--;
  if(teleportCooldown>0) teleportCooldown--;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(-camX, -camY);

  // Map background
  ctx.fillStyle="darkgreen";
  ctx.fillRect(0,0,mapSize,mapSize);

  // Stores
  ctx.fillStyle="orange";
  ctx.fillRect(itemStorePos.x-20,itemStorePos.y-20,40,40);
  ctx.fillStyle="cyan";
  ctx.fillRect(upgradeStorePos.x-20,upgradeStorePos.y-20,40,40);

  // Item
  ctx.fillStyle="yellow";
  ctx.beginPath();
  ctx.arc(targetItem.x,targetItem.y,targetItem.size/2,0,Math.PI*2);
  ctx.fill();

  // Player
  ctx.fillStyle="white";
  ctx.fillRect(player.x-20,player.y-20,40,40);

  ctx.restore();

  // Score
  ctx.fillStyle="white";
  ctx.font="20px sans-serif";
  ctx.fillText("üç¨ "+candyCorn, canvas.width-100, 30);

  // Locator arrow
  if(showArrow){
    ctx.strokeStyle="red";
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, canvas.height/2);
    ctx.lineTo(canvas.width/2 + (targetItem.x-player.x)/10, canvas.height/2 + (targetItem.y-player.y)/10);
    ctx.stroke();
  }
}

function spawnNewItem(){
  targetItem.x=Math.random()*mapSize;
  targetItem.y=Math.random()*mapSize;
}

function closeStore(id){
  document.getElementById(id).style.display="none";
}

function buyItem(type){
  if(type==="locator" && candyCorn>=5 && !hasLocator){
    candyCorn-=5;
    hasLocator=true;
    alert("Bought locator!");
    closeStore('itemStore');
  }
  if(type==="teleport" && candyCorn>=20 && !hasTeleporter){
    candyCorn-=20;
    hasTeleporter=true;
    alert("Bought teleporter!");
    closeStore('itemStore');
  }
}

function buyUpgrade(type){
  if(type==="locator"){
    if(locatorUpgrade<3 && candyCorn>=8){
      if(locatorUpgrade===0 || locatorUpgrade<3){
        candyCorn-=8;
        locatorUpgrade++;
        alert("Upgraded locator to L"+locatorUpgrade);
        closeStore('upgradeStore');
      }
    }
  }
  if(type==="teleport"){
    if(teleportUpgrade<3 && candyCorn>=8){
      if(teleportUpgrade===0 || teleportUpgrade<3){
        candyCorn-=8;
        teleportUpgrade++;
        alert("Upgraded teleporter to L"+teleportUpgrade);
        closeStore('upgradeStore');
      }
    }
  }
}

// Locator ability
let showArrow=false;
function useLocator(){
  if(hasLocator && locatorCooldown===0){
    let arrowTime=[2000,3000,4000,5000][locatorUpgrade];
    let cooldown=[5000,4000,3000,2000][locatorUpgrade];
    showArrow=true;
    setTimeout(()=>{showArrow=false;},arrowTime);
    locatorCooldown=cooldown/16.6; // frames
  }
}

// Teleporter ability
function useTeleporter(){
  if(hasTeleporter && teleportCooldown===0){
    player.x=targetItem.x;
    player.y=targetItem.y;
    let cooldown=[10000,25000,20000,15000][teleportUpgrade];
    teleportCooldown=cooldown/16.6;
  }
}

// Spawn button
function spawnCenter(){
  player.x=mapSize/2;
  player.y=mapSize/2;
}

gameLoop();
</script>
</body>
</html>
